// 파일 위치: components/aivoca/AivocaApp.tsx

import React, { useState, useEffect, useCallback } from 'react';
import { Brain, Upload, FileText, PlayCircle, X, PenTool, Trash2, ArrowLeft, Shuffle, List, Keyboard, MousePointerClick, CircleOff, Zap, Plus, Edit2, Calendar } from 'lucide-react';
// 1. 주소를 우리 프로젝트에 맞게 모두 수정했어!
import { ViewState, UserStats, Word, VocabBook } from './types';
import { generateWordData } from './services/geminiService';
import QuizMode from './components/QuizMode';
import WordList from './components/WordList';

const INITIAL_STATS: UserStats = { level: 1, xp: 0, streak: 0, totalWordsLearned: 0, quizAccuracy: 0, dailyGoal: 10, dailyProgress: 0 };
interface QuizSession { queue: Word[]; cursor: number; batchSize: number; }

// 2. 이름도 AivocaApp으로 바꿨어!
export default function AivocaApp() {
  const [view, setView] = useState<ViewState>('DASHBOARD');
  const [books, setBooks] = useState<VocabBook[]>([]);
  const [activeBookId, setActiveBookId] = useState<string | null>(null);
  const activeBook = books.find(b => b.id === activeBookId);
  const words = activeBook?.words || [];
  const [stats, setStats] = useState<UserStats>(INITIAL_STATS);
  const [isLoading, setIsLoading] = useState(false);
  const [showInputModal, setShowInputModal] = useState(false);
  const [rawInputText, setRawInputText] = useState('');
  const [newBookTitle, setNewBookTitle] = useState('');
  const [quizWords, setQuizWords] = useState<Word[]>([]);
  const [showQuizSetup, setShowQuizSetup] = useState(false);
  const [setupSourceWords, setSetupSourceWords] = useState<Word[]>([]);
  const [quizConfig, setQuizConfig] = useState<{ count: number; shuffle: boolean; mode: 'TYPING' | 'MULTIPLE_CHOICE' | 'OX'; speedMode: boolean; }>({ count: 10, shuffle: true, mode: 'TYPING', speedMode: false });
  const [quizSession, setQuizSession] = useState<QuizSession | null>(null);
  const [quizKey, setQuizKey] = useState(0);
  const [quizTimeLimit, setQuizTimeLimit] = useState<number | undefined>(undefined);

  useEffect(() => {
    const savedBooks = localStorage.getItem('aivoca_books');
    const savedStats = localStorage.getItem('aivoca_stats');
    if (savedBooks) { try { const parsedBooks = JSON.parse(savedBooks); if (Array.isArray(parsedBooks)) { setBooks(parsedBooks); } } catch (e) { console.error("Failed to parse saved books", e); setBooks([]); } }
    if (savedStats) { try { setStats(JSON.parse(savedStats)); } catch (e) { console.error(e); } }
  }, []);

  useEffect(() => {
    localStorage.setItem('aivoca_books', JSON.stringify(books));
    localStorage.setItem('aivoca_stats', JSON.stringify(stats));
  }, [books, stats]);

  const createBook = (title: string, newWords: Word[]) => { const newBook: VocabBook = { id: `book-${Date.now()}`, title: title || `단어장 ${new Date().toLocaleDateString()}`, createdAt: new Date().toISOString(), words: newWords }; setBooks(prev => [...prev, newBook]); return newBook.id; };
  const deleteBook = (id: string, e: React.MouseEvent | React.TouchEvent) => { e.stopPropagation(); e.preventDefault(); setTimeout(() => { if (window.confirm("정말 이 단어장을 삭제하시겠습니까? (복구할 수 없습니다)")) { setBooks(prev => prev.filter(b => b.id !== id)); if (activeBookId === id) { setActiveBookId(null); setView('DASHBOARD'); } } }, 10); };
  const renameBook = (id: string, e: React.MouseEvent | React.TouchEvent) => { e.stopPropagation(); e.preventDefault(); const book = books.find(b => b.id === id); if (!book) return; setTimeout(() => { const newTitle = window.prompt("새로운 단어장 이름을 입력하세요:", book.title); if (newTitle && newTitle.trim()) { setBooks(prev => prev.map(b => b.id === id ? { ...b, title: newTitle.trim() } : b)); } }, 10); };
  const initiateQuizSetup = (sourceWords: Word[]) => { setSetupSourceWords(sourceWords); setQuizConfig({ count: Math.min(20, sourceWords.length), shuffle: true, mode: 'TYPING', speedMode: false }); setShowQuizSetup(true); };
  const startConfiguredQuiz = () => { let fullQueue = [...setupSourceWords]; if (quizConfig.shuffle) { fullQueue.sort(() => Math.random() - 0.5); } const session: QuizSession = { queue: fullQueue, cursor: 0, batchSize: quizConfig.count }; setQuizSession(session); loadQuizBatch(session, 0); setShowQuizSetup(false); setView('QUIZ'); };
  const loadQuizBatch = (session: QuizSession, startIndex: number) => { const batch = session.queue.slice(startIndex, startIndex + session.batchSize); let timeLimit = undefined; if (quizConfig.speedMode) { let secondsPerQuestion = 10; if (quizConfig.mode === 'MULTIPLE_CHOICE') secondsPerQuestion = 5; if (quizConfig.mode === 'OX') secondsPerQuestion = 3; timeLimit = batch.length * secondsPerQuestion; } setQuizWords(batch); setQuizTimeLimit(timeLimit); setQuizKey(Date.now()); };
  const handleNextBatch = () => { if (!quizSession) return; const nextCursor = quizSession.cursor + quizSession.batchSize; const updatedSession = { ...quizSession, cursor: nextCursor }; setQuizSession(updatedSession); loadQuizBatch(updatedSession, nextCursor); };
  const startSubsetQuiz = (selectedWords: Word[]) => { if (selectedWords.length === 0) { alert("선택된 단어가 없습니다."); return; } setSetupSourceWords(selectedWords); setQuizConfig({ count: selectedWords.length, shuffle: true, mode: 'TYPING', speedMode: false }); setShowQuizSetup(true); };
  const handleDirectInput = async () => { if (!rawInputText.trim()) return; setIsLoading(true); setTimeout(async () => { const newWords = await generateWordData(rawInputText); const bookId = createBook(newBookTitle || "새 단어장", newWords); setIsLoading(false); setShowInputModal(false); setRawInputText(''); setNewBookTitle(''); setActiveBookId(bookId); setView('WORDLIST'); }, 100); };
  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => { const file = event.target.files?.[0]; if (!file) return; setIsLoading(true); const text = await file.text(); const newWords = await generateWordData(text); const fileName = file.name.replace('.txt', ''); const bookId = createBook(fileName, newWords); setIsLoading(false); setActiveBookId(bookId); setView('WORDLIST'); event.target.value = ''; };
  const saveQuizResults = (results: { correct: string[], incorrect: string[] }) => { if (!activeBookId) return []; const newStats = { ...stats }; newStats.totalWordsLearned += results.correct.length; let updatedWords: Word[] = []; setBooks(prevBooks => prevBooks.map(book => { if (book.id !== activeBookId) return book; updatedWords = book.words.map(w => { if (results.correct.includes(w.id)) { return { ...w, masteryLevel: Math.min(100, (w.masteryLevel || 0) + 20), incorrectCount: 0, lastReviewed: new Date() }; } if (results.incorrect.includes(w.id)) { return { ...w, masteryLevel: Math.max(0, (w.masteryLevel || 0) - 10), incorrectCount: (w.incorrectCount || 0) + 1, lastReviewed: new Date() }; } return w; }); return { ...book, words: updatedWords }; })); setStats(newStats); return updatedWords; };
  const handleQuizSave = (results: { correct: string[], incorrect: string[] }) => { saveQuizResults(results); };
  const handleQuizExit = (results: { correct: string[], incorrect: string[] }) => { saveQuizResults(results); setView('WORDLIST'); };
  const onQuizRetryRequest = (mode: 'ALL' | 'INCORRECT', currentResults: { correct: string[], incorrect: string[] }) => { const updatedAllWords = saveQuizResults(currentResults); let nextQuizWords: Word[] = []; if (mode === 'INCORRECT') { nextQuizWords = updatedAllWords.filter(w => currentResults.incorrect.includes(w.id)); } else { const currentIds = quizWords.map(w => w.id); nextQuizWords = updatedAllWords.filter(w => currentIds.includes(w.id)); nextQuizWords.sort(() => Math.random() - 0.5); } if (nextQuizWords.length === 0) { alert("복습할 단어가 없습니다. 단어장으로 이동합니다."); setView('WORDLIST'); return; } setQuizWords(nextQuizWords); setQuizTimeLimit(undefined); setQuizKey(Date.now()); };
  const updateWord = (id: string, updates: Partial<Word>) => { if (!activeBookId) return; setBooks(prev => prev.map(book => { if (book.id !== activeBookId) return book; return { ...book, words: book.words.map(w => w.id === id ? { ...w, ...updates } : w) }; })); };
  const toggleFavorite = (id: string) => { if (!activeBookId) return; setBooks(prev => prev.map(book => { if (book.id !== activeBookId) return book; return { ...book, words: book.words.map(w => w.id === id ? { ...w, isFavorite: !w.isFavorite } : w) }; })); setQuizWords(prev => prev.map(w => w.id === id ? { ...w, isFavorite: !w.isFavorite } : w)); };
  const hasNextBatch = quizSession ? (quizSession.cursor + quizSession.batchSize < quizSession.queue.length) : false;

  if (isLoading) { return (<div className="min-h-screen bg-[#0f172a] flex flex-col items-center justify-center text-white animate-fade-in"><div className="w-12 h-12 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mb-4"></div><p>단어장을 생성하고 있습니다...</p></div>); }

  return (
    <div className="min-h-screen bg-[#0f172a] text-slate-100 font-sans">
      <nav className="bg-[#0f172a] border-b border-slate-800 p-4"><div className="max-w-5xl mx-auto flex items-center justify-between"><div className="flex items-center gap-2 cursor-pointer" onClick={() => setView('DASHBOARD')}><Brain className="w-6 h-6 text-purple-500" /><span className="font-bold text-lg tracking-tight">AIVOCA</span></div>{view !== 'DASHBOARD' && activeBook && (<div className="flex gap-4 text-sm font-medium"><button onClick={() => initiateQuizSetup(words)} className={`hover:text-white ${view === 'QUIZ' ? 'text-purple-400' : 'text-slate-400'}`}>퀴즈</button><button onClick={() => setView('WORDLIST')} className={`hover:text-white ${view === 'WORDLIST' ? 'text-purple-400' : 'text-slate-400'}`}>단어장</button></div>)}</div></nav>
      <main className="max-w-5xl mx-auto p-4">
        {view === 'QUIZ' && (<QuizMode key={quizKey} words={quizWords.length > 0 ? quizWords : words} allWords={words} quizMode={quizConfig.mode} timeLimit={quizTimeLimit} onSave={handleQuizSave} onRetry={onQuizRetryRequest} onExit={() => setView('WORDLIST')} onToggleFavorite={toggleFavorite} hasNextBatch={hasNextBatch} onNextBatch={handleNextBatch} />)}
        {view === 'WORDLIST' && activeBook && (<div className="space-y-6 animate-fade-in"><div className="flex justify-between items-center bg-slate-800 p-4 rounded-xl border border-slate-700"><div><h2 className="text-xl font-bold text-white flex items-center gap-2">{activeBook.title}<button onClick={(e) => renameBook(activeBook.id, e)} className="p-2 hover:bg-slate-700 rounded-full transition-colors"><Edit2 className="w-4 h-4 text-slate-500 hover:text-white"/></button></h2><p className="text-sm text-slate-400">총 {words.length}개 단어 • {new Date(activeBook.createdAt).toLocaleDateString()} 생성</p></div><button onClick={() => { setActiveBookId(null); setView('DASHBOARD'); }} className="px-4 py-2 bg-slate-700 rounded-lg text-sm hover:bg-slate-600 transition-colors"><ArrowLeft className="inline w-4 h-4 mr-1"/> 내 단어장 목록</button></div><WordList words={words} filterType="ALL" onUpdateWord={updateWord} onToggleFavorite={toggleFavorite} onStartQuizWithWords={startSubsetQuiz} onStartFavoriteQuiz={() => initiateQuizSetup(words.filter(w => w.isFavorite))} /></div>)}
        {view === 'DASHBOARD' && (<div className="flex flex-col space-y-10 animate-fade-in py-10"><div className="text-center space-y-4"><h1 className="text-4xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 via-purple-400 to-cyan-400">나만의 단어장</h1><p className="text-slate-400 text-lg">학습할 단어장을 선택하거나 새로 만들어보세요.</p></div><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><div onClick={() => setShowInputModal(true)} className="group flex flex-col items-center justify-center p-8 bg-slate-800/30 border-2 border-dashed border-slate-700 hover:border-purple-500 rounded-2xl cursor-pointer transition-all hover:bg-slate-800/50 min-h-[200px]"><div className="w-12 h-12 rounded-full bg-purple-900/30 flex items-center justify-center text-purple-400 mb-4 group-hover:scale-110 transition-transform"><Plus className="w-6 h-6" /></div><h3 className="text-lg font-bold text-white mb-1">새 단어장 만들기</h3><p className="text-sm text-slate-500">직접 입력 또는 파일 업로드</p></div>{books.map(book => (<div key={book.id} onClick={() => { setActiveBookId(book.id); setView('WORDLIST'); }} className="group relative bg-slate-800 border border-slate-700 hover:border-purple-500 rounded-2xl p-6 cursor-pointer transition-all hover:shadow-lg hover:shadow-purple-500/10 min-h-[200px] flex flex-col"><div className="flex justify-between items-start mb-4"><div className="w-10 h-10 rounded-lg bg-indigo-900/30 flex items-center justify-center text-indigo-400"><Brain className="w-6 h-6" /></div><div className="flex gap-1 relative z-20" onClick={(e) => { e.stopPropagation(); e.preventDefault(); }} onMouseDown={(e) => { e.stopPropagation(); e.preventDefault(); }} onMouseUp={(e) => { e.stopPropagation(); e.preventDefault(); }}><button type="button" onClick={(e) => renameBook(book.id, e)} className="p-2 hover:bg-slate-700 rounded-full text-slate-500 hover:text-white transition-colors" title="이름 변경"><Edit2 className="w-4 h-4 pointer-events-none" /></button><button type="button" onClick={(e) => deleteBook(book.id, e)} className="p-2 hover:bg-slate-700 rounded-full text-slate-500 hover:text-red-400 transition-colors" title="삭제"><Trash2 className="w-4 h-4 pointer-events-none" /></button></div></div><h3 className="text-xl font-bold text-white mb-2 line-clamp-1 group-hover:text-purple-400 transition-colors">{book.title}</h3><div className="mt-auto pt-4 border-t border-slate-700/50 flex flex-col gap-2"><div className="flex items-center gap-2 text-sm text-slate-400"><List className="w-4 h-4" /><span>{book.words.length} 단어</span></div><div className="flex items-center gap-2 text-sm text-slate-400"><Calendar className="w-4 h-4" /><span>{new Date(book.createdAt).toLocaleDateString()}</span></div></div></div>))}</div><div className="text-center pt-10 border-t border-slate-800"><button onClick={() => { if (confirm("모든 단어장과 학습 기록을 초기화하시겠습니까? 이 작업은 되돌릴 수 없습니다.")) { localStorage.removeItem('aivoca_books'); localStorage.removeItem('aivoca_stats'); setBooks([]); setStats(INITIAL_STATS); setActiveBookId(null); setView('DASHBOARD'); } }} className="text-xs text-slate-600 hover:text-red-500 underline">모든 데이터 초기화</button></div></div>)}
      </main>
      {showInputModal && (<div className="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fade-in"><div className="bg-slate-900 border border-slate-700 w-full max-w-3xl h-[85vh] rounded-2xl shadow-2xl flex flex-col"><div className="flex items-center justify-between p-5 border-b border-slate-800"><h2 className="text-xl font-bold text-white flex items-center gap-2"><Plus className="text-purple-500 w-5 h-5"/>새 단어장 만들기</h2><button onClick={() => setShowInputModal(false)} className="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-full transition-colors"><X className="w-6 h-6" /></button></div><div className="p-5 border-b border-slate-800 bg-slate-900"><div className="flex flex-col gap-2"><label className="text-sm text-slate-400">단어장 이름</label><input type="text" value={newBookTitle} onChange={(e) => setNewBookTitle(e.target.value)} placeholder="예: 중3 영어 필수, 토익 기출..." className="w-full bg-slate-950 border border-slate-700 rounded-lg px-3 py-2 text-white focus:border-purple-500 outline-none"/></div></div><div className="flex-1 p-5 flex flex-col min-h-0 bg-slate-900/50"><div className="grid grid-cols-1 md:grid-cols-2 gap-6 h-full"><div className="flex flex-col h-full"><div className="mb-2 text-sm text-slate-400 flex justify-between items-center"><span className="font-bold text-white flex items-center gap-2"><PenTool className="w-4 h-4"/> 직접 입력</span>{rawInputText && (<button onClick={() => setRawInputText('')} className="text-xs text-red-400 hover:text-red-300">지우기</button>)}</div><textarea value={rawInputText} onChange={(e) => setRawInputText(e.target.value)} placeholder={`단어와 뜻을 입력하세요.\n\napple 사과\nbanana 바나나`} className="flex-1 w-full bg-slate-950 border border-slate-700 rounded-xl p-4 text-slate-200 placeholder-slate-600 focus:border-purple-500 outline-none resize-none font-mono custom-scrollbar text-sm"/></div><div className="flex flex-col h-full"><div className="mb-2 text-sm text-slate-400"><span className="font-bold text-white flex items-center gap-2"><Upload className="w-4 h-4"/> 파일 업로드 (.txt)</span></div><div className="flex-1 border-2 border-dashed border-slate-700 rounded-xl flex flex-col items-center justify-center p-6 text-center hover:bg-slate-800/50 hover:border-purple-500 transition-colors"><label className="cursor-pointer flex flex-col items-center w-full h-full justify-center"><FileText className="w-12 h-12 text-slate-500 mb-4"/><span className="text-slate-300 font-medium mb-1">텍스트 파일을 드래그하거나 클릭</span><span className="text-xs text-slate-500">.txt 파일만 지원됩니다</span><input type="file" accept=".txt" onChange={handleFileUpload} className="hidden" /></label></div></div></div></div><div className="p-5 border-t border-slate-800 flex justify-end gap-3 bg-slate-900 rounded-b-2xl"><button onClick={() => setShowInputModal(false)} className="px-5 py-3 text-slate-400 hover:text-white font-medium transition-colors">취소</button><button onClick={handleDirectInput} disabled={!rawInputText.trim()} className="px-8 py-3 bg-purple-600 hover:bg-purple-500 disabled:bg-slate-800 disabled:text-slate-600 disabled:cursor-not-allowed text-white rounded-xl font-bold transition-all shadow-lg shadow-purple-900/20 hover:shadow-purple-500/30 flex items-center gap-2"><Plus className="w-5 h-5" />입력한 내용으로 생성</button></div></div></div>)}
        {showQuizSetup && (<div className="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fade-in"><div className="bg-slate-900 border border-slate-700 w-full max-w-md rounded-2xl shadow-2xl p-6"><div className="flex items-center justify-between mb-6"><div className="flex items-center gap-4"><h2 className="text-xl font-bold text-white flex items-center gap-2"><Brain className="text-purple-500 w-6 h-6"/>퀴즈 설정</h2><button onClick={() => setQuizConfig({ ...quizConfig, speedMode: !quizConfig.speedMode })} className={`flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold transition-all border ${ quizConfig.speedMode ? 'bg-yellow-500/20 text-yellow-400 border-yellow-500/50 shadow-lg shadow-yellow-500/20' : 'bg-slate-800 text-slate-500 border-slate-700' }`}><Zap className={`w-3 h-3 ${quizConfig.speedMode ? 'fill-yellow-400' : ''}`}/>스피드 {quizConfig.speedMode ? 'ON' : 'OFF'}</button></div><button onClick={() => setShowQuizSetup(false)} className="text-slate-400 hover:text-white"><X className="w-6 h-6"/></button></div><div className="space-y-6"><div><label className="text-sm text-slate-400 mb-3 block">시험 방식</label><div className="grid grid-cols-3 gap-3"><button onClick={() => setQuizConfig({ ...quizConfig, mode: 'TYPING' })} className={`p-3 rounded-xl border text-left transition-all flex flex-col items-center justify-center ${ quizConfig.mode === 'TYPING' ? 'bg-indigo-900/30 border-indigo-500 ring-1 ring-indigo-500' : 'bg-slate-800 border-slate-700 hover:border-slate-500' }`}><Keyboard className={`w-6 h-6 mb-2 ${quizConfig.mode === 'TYPING' ? 'text-indigo-400' : 'text-slate-500'}`}/><div className={`font-bold text-sm ${quizConfig.mode === 'TYPING' ? 'text-indigo-200' : 'text-slate-300'}`}>주관식</div></button><button onClick={() => setQuizConfig({ ...quizConfig, mode: 'MULTIPLE_CHOICE' })} className={`p-3 rounded-xl border text-left transition-all flex flex-col items-center justify-center ${ quizConfig.mode === 'MULTIPLE_CHOICE' ? 'bg-purple-900/30 border-purple-500 ring-1 ring-purple-500' : 'bg-slate-800 border-slate-700 hover:border-slate-500' }`}><MousePointerClick className={`w-6 h-6 mb-2 ${quizConfig.mode === 'MULTIPLE_CHOICE' ? 'text-purple-400' : 'text-slate-500'}`}/><div className={`font-bold text-sm ${quizConfig.mode === 'MULTIPLE_CHOICE' ? 'text-purple-200' : 'text-slate-300'}`}>객관식</div></button><button onClick={() => setQuizConfig({ ...quizConfig, mode: 'OX' })} className={`p-3 rounded-xl border text-left transition-all flex flex-col items-center justify-center ${ quizConfig.mode === 'OX' ? 'bg-cyan-900/30 border-cyan-500 ring-1 ring-cyan-500' : 'bg-slate-800 border-slate-700 hover:border-slate-500' }`}><CircleOff className={`w-6 h-6 mb-2 ${quizConfig.mode === 'OX' ? 'text-cyan-400' : 'text-slate-500'}`}/><div className={`font-bold text-sm ${quizConfig.mode === 'OX' ? 'text-cyan-200' : 'text-slate-300'}`}>OX 퀴즈</div></button></div></div><div><label className="text-sm text-slate-400 mb-3 block">문제 수 선택 (총 {setupSourceWords.length}단어)</label><div className="grid grid-cols-4 gap-2">{[10, 20, 50].map(count => (<button key={count} disabled={setupSourceWords.length < count} onClick={() => setQuizConfig({ ...quizConfig, count })} className={`py-2 rounded-lg text-sm font-medium transition-colors ${ quizConfig.count === count ? 'bg-purple-600 text-white' : 'bg-slate-800 text-slate-300 hover:bg-slate-700 disabled:opacity-30' }`}>{count}개</button>))}<button onClick={() => setQuizConfig({ ...quizConfig, count: setupSourceWords.length })} className={`py-2 rounded-lg text-sm font-medium transition-colors ${ quizConfig.count === setupSourceWords.length ? 'bg-purple-600 text-white' : 'bg-slate-800 text-slate-300 hover:bg-slate-700' }`}>전체</button></div>{quizConfig.speedMode && (<div className="mt-3 text-center"><span className="inline-block px-3 py-1 bg-yellow-900/30 border border-yellow-700/50 rounded text-xs text-yellow-300 animate-pulse">⚡ 제한 시간: { quizConfig.count * ( quizConfig.mode === 'TYPING' ? 10 : quizConfig.mode === 'MULTIPLE_CHOICE' ? 5 : 3 ) }초 (문제당 { quizConfig.mode === 'TYPING' ? '10' : quizConfig.mode === 'MULTIPLE_CHOICE' ? '5' : '3' }초)</span></div>)}</div><div className="flex items-center justify-between bg-slate-800/50 p-4 rounded-xl"><div className="flex items-center gap-3"><Shuffle className="w-5 h-5 text-indigo-400" /><span className="text-slate-200">순서 랜덤 섞기</span></div><button onClick={() => setQuizConfig({ ...quizConfig, shuffle: !quizConfig.shuffle })} className={`w-12 h-6 rounded-full transition-colors relative ${quizConfig.shuffle ? 'bg-indigo-500' : 'bg-slate-600'}`}><div className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-all shadow-sm ${quizConfig.shuffle ? 'left-7' : 'left-1'}`}></div></button></div><button onClick={startConfiguredQuiz} className="w-full py-4 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white font-bold rounded-xl shadow-lg shadow-indigo-900/20 transition-all flex items-center justify-center gap-2"><PlayCircle className="w-5 h-5" />퀴즈 시작 ({quizConfig.count}문제)</button></div></div></div>)}
      </div>
    );
  }